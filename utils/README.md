# 工具函数目录

本目录包含应用的各种工具函数和通用逻辑，用于提高代码复用性和可维护性。

## 主要文件

- `api.js` - API接口封装，处理与后端服务的所有通信
- `util.js` - 通用工具函数，如日期格式化、数据处理等

## API 封装规范

`api.js` 文件中封装了所有与后端交互的接口，遵循以下规范：

1. 所有 API 函数应返回 Promise 对象
2. 统一处理请求错误和异常情况
3. 遵循 RESTful API 设计原则
4. 接口命名应清晰表达其功能

示例：
```javascript
// 获取用户信息
getUserInfo: () => {
  return request('/user/info', 'GET')
}

// 更新用户信息
updateUserInfo: (userInfo) => {
  return request('/user/update', 'POST', userInfo)
}
```

## 工具函数规范

`util.js` 文件中包含各种通用工具函数，遵循以下规范：

1. 函数应具有单一职责，功能明确
2. 提供完整的参数说明和返回值说明
3. 考虑边界情况和错误处理
4. 尽量保持纯函数设计，减少副作用

示例：
```javascript
/**
 * 日期格式化
 * @param {Date} date 日期对象
 * @param {String} fmt 格式字符串
 * @return {String} 格式化后的日期字符串
 */
const formatTime = (date, fmt = 'yyyy-MM-dd') => {
  // 实现代码
}
```

## 使用说明

在需要使用工具函数的页面或组件中，通过以下方式引入：

```javascript
const api = require('../../utils/api')
const util = require('../../utils/util')

// 调用 API
api.getUserInfo().then(res => {
  // 处理响应
})

// 使用工具函数
const formattedDate = util.formatTime(new Date())
```

# AI绘画功能技术文档

## 功能概述

AI绘画功能使用文生图（Text-to-Image）技术，根据用户提供的文字描述生成相应的图像。用户可以选择不同的风格，调整创意度和图像质量参数，生成符合自己需求的AI艺术作品。

## 页面结构

- **提示词输入区**：用户输入描述性文字
- **风格选择区**：提供多种预设风格选项
- **参数设置区**：调整创意度和图像质量
- **生成按钮**：触发AI绘画过程
- **结果展示区**：显示生成的图像及操作选项
- **历史记录区**：展示用户之前的创作记录

## API接口

### 生成图像接口

**接口路径**: `/draw/generate`

**请求方法**: `POST`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|-----|------|
| prompt | string | 是 | 文字描述，用于生成图像 |
| style | string | 是 | 风格ID，如realistic, cartoon, ink等 |
| creativity | number | 否 | 创意度，范围0-100，默认75 |
| quality | number | 否 | 图像质量，范围0-100，默认85 |
| width | number | 否 | 图像宽度，默认512 |
| height | number | 否 | 图像高度，默认512 |

**响应示例**:

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "imageUrl": "https://example.com/generated/image123.jpg",
    "prompt": "一片星空下的湖泊，倒映着满天繁星",
    "timestamp": 1678956123456
  }
}
```

## 存储规范

### 历史记录存储

历史记录使用微信小程序的本地存储功能(`wx.setStorageSync`)，存储在`drawHistory`键下。

存储格式:

```json
[
  {
    "id": 1678956123456,
    "prompt": "一片星空下的湖泊，倒映着满天繁星",
    "style": "写实风格",
    "imageUrl": "https://example.com/generated/image123.jpg",
    "timestamp": 1678956123456
  },
  // 更多历史记录...
]
```

## 前端配置

### 风格选项配置

风格选项在页面初始化时设置，可根据需要扩展或修改。目前支持以下风格:

- 写实风格 (realistic)
- 卡通风格 (cartoon)
- 水墨风格 (ink)
- 油画风格 (oil)
- 素描风格 (sketch)
- 动漫风格 (anime)
- 赛博朋克 (cyberpunk)
- 奇幻风格 (fantasy)

### 参数设置说明

- **创意度**: 值越高，生成的内容越有创意但可能偏离提示词
- **图像质量**: 值越高，生成的图像质量越好但耗时更长

## 开发注意事项

1. **适配性考虑**: 确保在不同尺寸的设备上都能正确显示
2. **错误处理**: 添加完善的错误处理和用户提示
3. **权限请求**: 保存图片时需要获取相册权限
4. **加载状态**: 生成图片过程中显示加载状态
5. **图像优化**: 考虑图像压缩和缓存策略

## 后期优化方向

1. **风格预览**: 为每个风格添加示例图片
2. **提示词辅助**: 提供热门提示词和自动补全功能
3. **批量生成**: 支持一次生成多张不同变体
4. **图像编辑**: 添加简单的图像编辑功能
5. **模型选择**: 支持选择不同的AI模型

## 使用示例

1. 输入提示词: "一片星空下的湖泊，倒映着满天繁星"
2. 选择风格: "写实风格"
3. 调整参数: 创意度80，质量90
4. 点击"开始创作"按钮
5. 等待图像生成完成
6. 保存或分享生成的图像 